name: "Process Discovery"
tests:
  - name: Get all processes
    guid: 019a8de9-49b2-7670-9f84-b537e0dfc8f9
    language: AppleScript
    description: "Retrieves a list of all running processes on the system using System Events. This provides comprehensive process enumeration capabilities and may require TCC approval for System Events access."
    tcc_required: true
    command: |
      tell application "System Events" to get name of every process

  - name: Get all application processes (User facing applications)
    guid: 019a8de9-49b2-7670-9f84-b538179c19b6
    language: AppleScript
    description: "Retrieves only user-facing application processes (excluding system processes and daemons). This focuses on applications that users typically interact with and may require TCC approval for System Events access."
    tcc_required: true
    command: |-
      tell application "System Events"
        set runningApps to name of every application process
        repeat with appName in runningApps
          log appName
        end repeat
      end tell

  - name: Get list of running processes using AppKit
    guid: 019a8de9-49b2-7670-9f84-b539564fc5dc
    references:
      - https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/
    language: AppleScript
    description: "Retrieves running applications using AppKit framework."
    tcc_required: true
    command: |-
      use framework "AppKit"
      use framework "Foundation"

      set r to {}
      set activeApps to current application's NSWorkspace's sharedWorkspace's runningApplications()
      repeat with anApp in activeApps
          try
              set this_app to anApp's localizedName() as text
              if this_app is not missing value and this_app is not "" then
                  set end of r to this_app
              end if
          on error
              -- Skip apps without names
          end try
      end repeat
      return r
