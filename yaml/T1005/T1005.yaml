name: Data from Local System
tests:
  - name: Copy Apple Notes database
    description: This command will copy Apple Notes database files using AppleScript as seen in Atomic Stealer.
    #TODO: replace with Atomic Stealer URL
    reference: https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1005/T1005.yaml
    language: AppleScript
    tcc_required: true
    command: |
      tell application "Finder"
        set destinationFolderPath to POSIX file "#{destination_path}"
        set notesFolderPath to (path to home folder as text) & "Library:Group Containers:group.com.apple.notes:"
        set notesFolder to folder notesFolderPath
        set notesFiles to {file "NoteStore.sqlite", file "NoteStore.sqlite-shm", file "NoteStore.sqlite-wal"} of notesFolder
        repeat with aFile in notesFiles
          duplicate aFile to folder destinationFolderPath with replacing
        end repeat
      end tell
    args:
      destination_path: "/tmp"
